# Labs07_01 : 웹서버 연동
## JBoss EWS 설치

JBoss EWS 2.1 다운로드 :
```
]# su -
]# cd /jboss
```
JBoss EWS 2.1 압축해제 :
```
]# unzip jboss-ews-httpd-2.1.0-RHEL6-x86_64.zip
]# rm -f jboss-ews-httpd-2.1.0-RHEL6-x86_64.zip
```
postinstall 툴로 경로 설정 :
```
]# cd /jboss/jboss-ews2.1/httpd
]# ./.postinstall
```
JBoss EWS 2.1 실행 :
```
]# cd /jboss/jboss-ews2.1/httpd/sbin
]# ./apachectl start
```
## ModJK 설정
httpd.conf에서 mod_jk 주석 제거 :
```
]# cd /jboss/jboss-ews2.1/httpd/conf
]# vim httpd.conf
      ...
   # mod_jk
   LoadModule jk_module /jboss/jboss-ews-2.1/httpd/modules/mod_jk.so
      ...
```
### 관련 설정 파일 추가
httpd-jk.conf 설정 :
```
]# cd /jboss/jboss-ews2.1/httpd/conf.d
]# vi httpd-jk.conf
 
# 1. Load Module jk_module

<IfModule !mod_jk.c>
   LoadModule jk_module modules/mod_jk.so
</IfModule>/jboss/jboss-ews2.1/httpd/
# 2. jk_module Global configuration of the server
<IfModule mod_jk.c>
   JkWatchdogInterval 60
   JkWorkersFile conf/extra/workers.properties
   JkLogFile "|/jboss/jboss-ews2.1/httpd/sbin/rotatelogs /jboss/jboss-ews2.1/httpd/logs/modjk-log/mod-jk.log.%Y%m%d 86400"
   JkLogLevel error
   JkLogStampFormat "[%Y %a %b %d %H:%M:%S]"
   JKRequestLogFormat "%s %w %R %V %T"
   JkOptions +ForwardKeySize +ForwardURICompatUnparsed -ForwardDirectories
   JkMountFile conf.d/uriworkermap.properties
   JkShmFile logs/modjk-log/mod-jk.shm
   JkMountCopy All
</IfModule>
# 3. Allow jk Connector server status reports generated by jkstatus,
<Location /jkstatus>
    jkmount jkstatus
    Order deny,allow
    Deny from all
    #Allow from 127.0.0.1
    Allow from all
</Location>
```
workers.properties 설정 :
```
]# cd /jboss/jboss-ews2.1/httpd/conf.d
]# vi workers.properties

#
# HTTPD Web Server and Apache Tomcat(ajp) Connector
# the loadbalancer configuration of the Server
#
# Include workers.properties by conf/extra/httpd-modjk.conf
#
# Define loadbalancer 2 worker node using ajp13
worker.list=labsSvr,jkstatus
 
# admin Cluster Group 1 #############################################
#
# configuration template
worker.template.type=ajp13
#worker.template.lbfactor=1
worker.template.socket_timeout=60
worker.template.socket_keepalive=false
worker.template.recovery_options=7
worker.template.ping_mode=A
worker.template.ping_timeout=10000
worker.template.reply_timeout=10000
 

#worker.template.connection_pool_size=25
#worker.template.connection_pool_minsize=25
worker.template.connection_pool_timeout=30
 
#
# configuration web1
worker.labsSvr.reference=worker.template
worker.labsSvr.host=192.168.56.101
worker.labsSvr.port=8009

#
# configuration loadbalancer
#worker.wlb.type=lb
#worker.wlb.retries=2
#worker.wlb.method=Session
#worker.wlb.sticky_session=True
#worker.wlb.sticky_session=False
#worker.wlb.balance_workers=labsSvr

worker.jkstatus.type=status
```
uriworkermap.properties 설정 :
```
]# cd /jboss/jboss-ews2.1/httpd/conf.d
]# vi uriworkermap.properites

/*=labsSvr
```
modjk-log 파일 생성 :
```
]# cd /jboss/jboss-ews2.1/httpd/logs
]# mkdir modjk-log
```
웹서버 연동 확인 :
(http://192.168.56.101/index.jsp) 접속
